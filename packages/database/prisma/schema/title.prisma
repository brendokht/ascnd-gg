model Title {
  id                String                @id @default(uuid(7))
  name              String                @unique
  displayName       String                @map("display_name")
  genreId           String                @map("genre_id")
  genre             TitleGenre            @relation(fields: [genreId], references: [id], onDelete: Restrict)
  allowsDraws       Boolean               @default(false) @map("allows_draws")
  defaultDrawPolicy DrawResolutionPolicy? @map("default_draw_policy")
  createdAt         DateTime              @default(now()) @map("created_at")
  updatedAt         DateTime              @default(now()) @updatedAt @map("updated_at")

  maps                  TitleMap[]
  characters            TitleCharacter[]
  gamemodes             TitleGamemode[]
  settings              TitleSetting[]
  items                 TitleItem[]
  roles                 TitleRole[]
  stageSettingTemplates StageSettingTemplate[]
  events                Event[]

  @@map("title")
}

model TitleGenre {
  id          String   @id @default(uuid(7))
  name        String   @unique
  displayName String   @map("display_name")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  titles Title[]

  @@map("title_genre")
}

model TitleMap {
  id              String         @id @default(uuid(7))
  titleId         String         @map("title_id")
  title           Title          @relation(fields: [titleId], references: [id], onDelete: Restrict)
  image           String?
  name            String
  displayName     String         @map("display_name")
  metadata        Json?          @db.JsonB
  active          Boolean        @default(true)
  titleGameModeId String?
  titleGameMode   TitleGamemode? @relation(fields: [titleGameModeId], references: [id], onDelete: Restrict)
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @default(now()) @updatedAt @map("updated_at")

  @@unique([titleId, name])
  @@map("title_map")
}

model TitleCharacter {
  id          String   @id @default(uuid(7))
  titleId     String   @map("title_id")
  title       Title    @relation(fields: [titleId], references: [id], onDelete: Restrict)
  image       String?
  name        String
  displayName String   @map("display_name")
  metadata    Json?    @db.JsonB
  active      Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  characterRoles TitleCharacterRole[]

  @@unique([titleId, name])
  @@map("title_character")
}

model TitleCharacterRole {
  characterId String         @map("character_id")
  character   TitleCharacter @relation(fields: [characterId], references: [id], onDelete: Restrict)
  roleId      String         @map("role_id")
  role        TitleRole      @relation(fields: [roleId], references: [id], onDelete: Restrict)

  @@id([characterId, roleId])
  @@map("title_character_role")
}

model TitleRole {
  id          String   @id @default(uuid(7))
  titleId     String   @map("title_id")
  title       Title    @relation(fields: [titleId], references: [id], onDelete: Restrict)
  image       String?
  name        String
  displayName String   @map("display_name")
  payload     Json?    @db.JsonB
  active      Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  characterRoles TitleCharacterRole[]

  @@unique([titleId, name])
  @@map("title_role")
}

model TitleGamemode {
  id          String   @id @default(uuid(7))
  titleId     String   @map("title_id")
  title       Title    @relation(fields: [titleId], references: [id], onDelete: Restrict)
  image       String?
  name        String
  displayName String   @map("display_name")
  metadata    Json?    @db.JsonB
  active      Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  titleMaps TitleMap[]

  @@unique([titleId, name])
  @@map("title_gamemode")
}

model TitleSetting {
  id          String   @id @default(uuid(7))
  titleId     String   @map("title_id")
  title       Title    @relation(fields: [titleId], references: [id], onDelete: Restrict)
  image       String?
  name        String
  displayName String   @map("display_name")
  payload     Json?    @db.JsonB
  active      Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  @@unique([titleId, name])
  @@map("title_setting")
}

model TitleItem {
  id          String   @id @default(uuid(7))
  titleId     String   @map("title_id")
  title       Title    @relation(fields: [titleId], references: [id], onDelete: Restrict)
  image       String?
  name        String
  displayName String   @map("display_name")
  payload     Json?    @db.JsonB
  active      Boolean  @default(true)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  @@unique([titleId, name])
  @@map("title_item")
}

enum DrawResolutionPolicy {
  ALLOW_DRAW
  TIEBREAKER
  ADMIN_DECISION
  FALLBACK

  @@map("draw_resolution_policy")
}
